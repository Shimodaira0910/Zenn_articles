---
title: "boto3ã§AWS WAFã®IPãƒªã‚¹ãƒˆãŒå–å¾—ã§ããªã„ä»¶"
emoji: "ğŸ˜‘"
type: "tech"
topics:
  - "aws"
  - "python"
  - "ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°"
  - "boto3"
published: true
published_at: "2024-07-17 09:42"
---

## ã¯ã˜ã‚ã«
ã¡ã‚‡ã£ã¨ã—ãŸãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è¨˜äº‹ã«ãªã‚Šã¾ã™ã€‚

## ä½¿ã£ãŸã‚‚ã®
| ä½¿ã£ãŸã‚‚ã® | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
| --- |  --- |
| macOS | Sonoma 14.2 |
| Python | 3.9ç³» |
| boto3  | 1.34.110 |

## ä½•ãŒã‚ã£ãŸã®ã‹ï¼Ÿ
CloudFrontã«è¨­å®šã—ã¦ã‚ã‚‹WAFv2ã‹ã‚‰ã€æŒ‡å®šã—ãŸIPãƒªã‚¹ãƒˆã‚’å–å¾—ã™ã‚‹ã¨ã„ã†éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ãªå‡¦ç†ã‚’å®Ÿè£…ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã—ãŸã€‚ã§ã€boto3 WAFv2ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã§ã¿ã¦ã€ã€Œã‚ã‚ã€ã“ã®`get_ip_set()`ã£ã¦é–¢æ•°ä½¿ãˆã°ã„ã„ã‚“ã ã€œã€ã¨æ€ã„æ—©é€Ÿå®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸã€‚
https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/wafv2/client/get_ip_set.html

```python:main.py
def get_ip_set_list() -> List:
    client = boto3.client('wafv2')
    IP_SET_NAME = 'IP_SET_NAME'
    Scope = 'CLOUDFRONT'
    Id = 'IP_SET_ID'

    response = client.get_ip_set(
        Name=IP_SET_NAME,
        Scope=Scope,
        Id=Id
    )

    return response['IPSet']['Addresses']

def main():
    ip_set = get_ip_set_list()
    print(ip_set)

if __name__ == '__main__':
    main()
```

ãŒã€å®Ÿè¡Œã™ã‚‹ã¨ä½•æ•…ã‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã€‚
```error:error
botocore.errorfactory.WAFInvalidParameterException: An error occurred (WAFInvalidParameterException) when calling the GetIPSet operation: Error reason: The scope is not valid., field: SCOPE_VALUE, parameter: CLOUDFRONT
```
SCOPEã®CLOUDFRONTãŒã©ã†ã‚„ã‚‰ç„¡åŠ¹ã¨ã®ã“ã¨ã§ã™ã€‚
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ã€ã‚¹ã‚³ãƒ¼ãƒ—ã«ã¯ã€ŒCLOUDFRONTã€ã¨ã€ŒREGIONALã€ãŒæŒ‡å®šã§ãã‚‹ã‚ˆã†ã«è¦‹å—ã‘ã‚‰ã‚Œã¾ã™ã—ã€ãã‚Œä»¥å¤–ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ã©ã“ã«ã‚‚æ›¸ã„ã¦ã‚ã‚Šã¾ã›ã‚“...ğŸ§
```python
response = client.get_ip_set(
    Name='string',
    Scope='CLOUDFRONT'|'REGIONAL',
    Id='string'
)
```

## è§£æ±ºæ–¹æ³•
`get_ip_set()`é–¢æ•°ã®å¼•æ•°ã®æ¬„ã‚’ã‚‚ã†å°‘ã—æ³¨æ„æ·±ãè¦‹ã¦ã¿ã‚‹ã¨ã€ä¸‹è¨˜è¨˜è¿°ãŒã‚ã‚Šã¾ã—ãŸã€‚

> To work with CloudFront, you must also specify the Region US East (N. Virginia) as follows:
CLI - Specify the Region when you use the CloudFront scope: --scope=CLOUDFRONT --region=us-east-1.
API and SDKs - For all calls, use the Region endpoint us-east-1.
(æ—¥æœ¬èªè¨³)
CloudFrontã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«Region US East (N. Virginia)ã‚‚æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
CLI - CloudFrontã‚¹ã‚³ãƒ¼ãƒ—ã‚’ä½¿ç”¨ã™ã‚‹éš›ã«Regionã‚’æŒ‡å®šã—ã¾ã™ï¼š --scope=CLOUDFRONT --region=us-east-1.
APIã¨SDK - ã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ«ã§ã€Regionã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆus-east-1ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚


SCOPEã§CLOUDFRONTã‚’æŒ‡å®šã™ã‚‹ã«ã¯ã€regionã«us-east-1ã‚’æŒ‡å®šã—ã‚ã¨æ‡‡åˆ‡ä¸å¯§ã«æ›¸ã„ã¦ã‚ã‚‹ã˜ã‚ƒãªã„ã§ã™ã‹ï¼ãã‚‚ãã‚‚WAFv2ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«ã‚‚æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚
https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/wafv2.html

> For Amazon CloudFront applications, you must use the API endpoint listed for US East (N. Virginia): us-east-1.
(æ—¥æœ¬èªè¨³)
> Amazon CloudFrontã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€US East (N. Virginia)ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆus-east-1ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã‚ªã‚¤ã‚ªã‚¤ã‚ªã‚¤ã€ã“ã“ã¾ã§ãã‚‹ã¨ç§ã®ç›®ãŒç¯€ç©´ã™ãã¦æ¥ãšã‹ã—ã„ã€‚
ã§ã€çµå±€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§å®Ÿè£…ã—ãŸã¨ã“ã‚ã€ãªã‚“ã¨ã‹å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

```python:main.py
adef get_ip_set_list() -> List:
    ### us-east-1è¿½åŠ  ###
    client = boto3.client('wafv2', region_name='us-east-1')
    ####################
    IP_SET_NAME = 'IP_SET_NAME'
    Scope = 'CLOUDFRONT'
    Id = 'IP_SET_ID'

    response = client.get_ip_set(
        Name=IP_SET_NAME,
        Scope=Scope,
        Id=Id
    )

    return response['IPSet']['Addresses']

def main():
    ip_set = get_ip_set_list()
    print(ip_set)

if __name__ == '__main__':
    main()

```

```çµæœ:result
['1.1.1.1/32', '2.2.2.2/32' .....<é•·ã„ã®ã§å‰²æ„›>
```

## ãŠã‚ã‚Šã«
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ä¸å¯§ã«èª­ã¿ã¾ã—ã‚‡ã†ã­...ã€‚

## å‚è€ƒè³‡æ–™
https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/wafv2.html
https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/wafv2/client/get_ip_set.html
